\subsection{Polyrational functions}

\subsubsection{One pebble transducers}
A one pebble transducer of input alphabet $\Sigma$ and output alphabet $\Gamma$ is a two way automaton (meaning that it has a reading head, called here a pebble, which can scann the word on both directions) which reads words over $\Sigma^*$, and which has the ability to output words over $\Gamma^*$ on every transition. A configuration looks like this:
\begin{center}
Picture
\end{center} 
The output of a one pebble transducer is the concatenation of the outputs of the transitions it tooks, in the chrnological order of their emission.

\begin{definition}\label{def:1pebble}
A 1-pebble transducer is a tuple $(\Sigma,\Gamma, Q, q_I, q_F, \delta)$, which consists of:
\begin{itemize}
\item a finite input alphabet $\Sigma$ and a finite output alphabet $\Gamma$; 
\item a finite set of states $Q$;
\item two designated states $q_I$ and $q_F$: the initial and final one;
\item  a transition function of type 
$$\delta : Q\times \Sigma\cup\{\vdash,\dashv\} \to Q\times\set{\rightarrow,\leftarrow}\times\Gamma^*$$
The symbols  $\vdash$ and $\dashv$ are the endmarkers of the word. 
\end{itemize}
We assume that the transducer can only move to the right when it is on the left endmarker $\vdash$, and only to the left when  it is on the right endmarker $\dashv$.
 \end{definition}


Let us define the beahivous of the transducer over an input word $w\in\Sigma^*$. The transducer reads the word $\vdash\!w\!\dashv$ which we denote by  $w_{\vdash\dashv}$. \emph{A configuration} is a pair $(q,i)$ where $q$ is the control state and $i$ the position of the pebble on $w_{\vdash\dashv}$. 

Let $(p,i)$ be a configuration and suppose that $\delta(p, w_{\vdash\dashv}[i])=(q,d,o)$. \emph{The successor of $(p,i)$} is the configuration $(q,j)$
where:
\begin{align*}
 j=i+1 &\qquad \text{ if }\qquad d=\ \rightarrow\\
 j=i-1 &\qquad \text{ if }\qquad d=\ \leftarrow 
\end{align*}
\emph{The output of $(p,i)$} is the word $o$. \emph{A run} on $w$ is a sequence of configurations over $w$ related by a the successor relation defined above. The output of a run is the word obtained by concatenating the outputs of its configurations.

% such that $c_{i+1}$ is the successor of $c_i$. \emph{The output} of a run is the word $(\mathsf{out}(c_i))_{0\leq i\leq n}$. 

The initial configuration is $(q_I, 0)$. The automaton accepts a word if there is an accepting run,
i.e. a run where the first configuration is initial, the last one has an accepting
state, and no other configurations have an accepting state. The accepting run, if it exists, is unique, by determinism of the transition function.


\subsubsection{$k$-pebble transducers}

In the litterature~\cite{}, a $k$-pebble transducer is a transducer with $k$ reading heads. The movement of thease heads is subject to a stack discipline: only the pebble on top of the stack can move. Add details, an a precise definition of this version of $k$-pebble automata. 
In this paper, we will work witha different yet equivalent definition of $k$-pebble automata. Here a $k$-pebble transducer is a collection of $k$ one pebble automata. Add an informal definition.
\begin{center}
Picture
\end{center}
Let $k, i\in \mathbb{N}$. We set $\Sigma_{[i,k]}=\Sigma\cup\Sigma\times \mathbf 2^{[i,k]}$.  
In the alphabet $\Sigma_{[k, i+1]}$, we have the possibility to mark some letters of $\Sigma$ by the information of wich pebbles are under head. 

 
\begin{definition}%[$k$-pebble transducer]
A $k$-pebble transducer of input alphabet $\Sigma$ and output alphabet $\Gamma$ is a tuple $\Tt=(T_k,\dots,T_{1})$ such that for every $i\leq n$:
\begin{itemize}
\item  $T_i$ is 1-pebble transducer, whose set of states is $Q_i$;
\item  The input alphabet of $T_i$ is $\Sigma_{[i+1,k]}$;
\item  The output alphabet of $T_i$ is $\Gamma\cup\bigcup_{1\leq j <i } Q_j$.
\end{itemize} 
In particular, the input alphabet of $T_k$ is $\Sigma$ and the output alphabet of $T_1$ is $\Gamma$. We denote by $\Tt_i$ the transducer $T_i$. 
\end{definition}

The alphabet $(\Gamma_{[l,m]})_{[m+1,n]}$ can be seen as the alphabet $\Gamma_{[l,n]}$. Indeed, every letter of $(\Gamma_{[l,m]})_{[m+1,n]}$ of the form $((a,e),f)$ where $e\subseteq [l,m]$ and 
$f\subseteq [m+1,n]$ can be seen a a letter $(a,e\cup f)$ of $\Gamma_{[l,n]}$ and conversely.

With this in mind, for every $k$-pebble transducer $\Tt=(T_j)_{j\in[1,k]}$ and $i\in[1,k]$,  the sequence $(T_j)_{j\in[1,i]}$ can be seen as an $i$-pebble transducer, of input alphabet $\Gamma_{[i+1,k]}$ and output alphabet $\Gamma$. Similarly, the sequence   $(T_j)_{j\in[i+1,k]}$ can be seen as a $(k-i)$-pebble transducer, of input alphabet $\Gamma$ and output alphabet $\Sigma\cup\bigcup_{j\in[1,i]} Q_j$. We denote them respectively by $\Tt[1,i]$ and $\Tt[i+1,k]$. 
 
 \medskip
\begin{terminology} 
 A $k$-pebble transducer $\Tt$ can be seen as the one pebble transducer $\Tt_k$, which outsources a part of the computation to the other one pebble transducers $\Tt_i$, $i<k$. 
 For this reason, we call \emph{the states of $\Tt$} the states of $\Tt_k$, and \emph{the initial state of $\Tt$} the initial state of $\Tt_k$. 
  \end{terminology}
  
  \smallskip
 Let us define the function realized by a $k$-pebble transducer. 
  
  \begin{definition}
We define, by induction on $k$ the function, realized by a $k$-pebble automation. The case $k=1$ has been treated in Definition~\ref{def:1pebble}. 

Consider a $k+1$ pebble transducer $\Tt$. We set $Q_i$ to be the set of states of $\Tt_i$.
Let us define the image of a word $w$ of $\Sigma^*$ by the transduction realized by $\Tt$.

\noindent Let $r=(q_j,\mathsf{pos}_j)_{j\in[1, n]}$ be the accepting run of $\Tt_{k+1}$ over $w$ and $(o_j)_{j\in[1, n]}$ be the outputs of the corresponding configurations.

\noindent For every $q\in Q_i$, let $f^i_q:\Sigma_{[k,i+1]}^*\rightarrow \Gamma^*$ be the transduction realized by $\Tt[1,i]$, considering $q$ as its initial state.
 
 For every $j\in[1,n]$, let $w_j$ be the word obtained from $w$ by replacing the letter $a$ at position $\mathsf{pos}_j$ by $(a,k+1)$.
    For every $j\in[1,n]$, let $u_j$ be the word obtained from $o_j$ by replacing every state $q\in Q_i$ by $f^i_q(w_j)$.
    
The image of $w$ by $\Tt$ is the word $(u_j)_{j\in[1,n]}$.
\end{definition}

\begin{example}
\begin{center}
Add an example.
\end{center}
\end{example}



\begin{proposition}
The function realized by a $k$-pebble transducer is $\mathcal{O}(n^k)$ in the lenght of the input word.
\end{proposition}

\subsection{Transition monoids}
We present in this section a tool used to summarize the behaviour of one-pebble automata, and called transition monoids. A chaque mot $w$, on associera un element de ce monoid qui nous dira: si j'entre dans le mot $w$ (par la droite ou par la gauche) en etant dans un certain atat $q$, alors je vais sortir du mot par la droite ou la  la gauche avec un certain etat. Suivant le besoin, on aura besoin d'enregistrer en plus des information sur l'output. Soit le mot emis en entier (c'est le monoid $M_{\Gamma^*}$), ou alors une information binaire qui dit si oui ou non j'ai emis un mot (c'est le monoid $M_{\mathbf{2}}$) ou alors pas du tout d'information sur l'output (c'est le monoid $M_{\mathbf{0}}$).

   
\begin{definition}%[Transition monoid of a 1-pebble transducer]
Let $T$ be a 1-pebble automaton with set of states $Q$. Let $\Delta$ be a monoid, and let $\star$ be its multiplication.

We define the transition monoind $M_\Delta$ of $T$ as follows:
\begin{itemize}
\item its elements are functions of the form $f:Q\times\set{\rightarrow,\leftarrow}\to Q\times\set{\rightarrow,\leftarrow}\times \Delta$;
\item the composition $\cdot$ is defined as follows. Let $f, g$ be two elements of $M(\Delta)$, $q\in Q$ and $d\in\set{\rightarrow, \leftarrow}$. We define the \emph{transition sequence} between 
$f$ and $g$ starting from $(q,d)$ and its \emph{output sequence} to be respectively the sequences $(q_i,d_i)_{i\in[0,n]}$ and  $(w_i)_{i\in[1,n]}$ satisfying the following conditions: 
\begin{itemize}
\item $(q_0,d_0)=(q,d)$;
\item $d_0=d_1$, $d_{n-1}=d_{n}$ and $d_i\neq d_{i+1}$ for every $i\in[1,n-2]$;
\item if $d_0=\rightarrow$ then for every even $i$, $f(q_i,d_i)=(q_{i+1},d_{i+1}, w_{i+1})$ and for every odd $i$, $g(q_i,d_i)=(q_{i+1},d_{i+1}, w_{i+1})$;
\item if $d_0=\rightarrow$ then for every even $i$, $g(q_i,d_i)=(q_{i+1},d_{i+1}, w_{i+1})$ and for every odd $i$, $f(q_i,d_i)=(q_{i+1},d_{i+1}, w_{i+1})$. 
\end{itemize}
We set $(f\cdot g) (q,d)$ to be $(q_n, d_n, w_0\star\dots\star w_n)$.
\end{itemize}
\end{definition}
We will mainly instanciate $M_\Delta$ in the following three cases: 
\begin{enumerate}
\item $\Delta$ is the monoid $\Gamma^*$ of words over $\Gamma$.
\item $\Delta$ is the boolean monoid $\mathbf 2$.
\item $\Delta$ is the singleton monoid $\mathbf 0$.
\end{enumerate}
In the last case, the third component of the codomain of the elements of $M_{\mathbf 1}$ is useless, one can be see them as functions of type $Q\times\set{\rightarrow,\leftarrow}\to Q\times\set{\rightarrow,\leftarrow}$.

\begin{example}
\begin{center}
Show two boxes and their composition.

Give an example of transition sequence.
\end{center}
\end{example}

Let us show how to interpret words as elements of the monoid 
\begin{definition}
Let $T=(\Sigma, \Gamma, Q, q_I, q_F, \delta)$ be a 1-pebble transducer. 
We define the morphism $\mu:\Sigma^*\to M_{\Gamma^*}$ as follows:
$$\text{For every } d\in \set{\rightarrow,\leftarrow}\qquad\mu(a)(q,d)=\delta(a,q)$$
et $\Delta\subseteq \Gamma$. We define the morphism $\mu_\Delta:\Sigma^*\to M_{\mathbf 2}$ as follows. Let $1_\Delta:\Gamma^*\to \mathbf{2}$ be the morphisme defined on letters as follows $1_\Delta(a)=1$ if $a\in \Delta$ and $1_\Delta(a)=0$ otherwise. We set then for every $d\in\set{\rightarrow,\leftarrow}$: 
$$\text{If } \delta(a,q)=(q',d',w) \text{ then } \mu(a)(q,d)=(q',d',1_\Delta(w))$$
We define the morphism $\mu_{\mathbf{0}}:\Sigma^*\to M_{\mathbf 0}$ as follows. For every $d\in\set{\rightarrow,\leftarrow}$,
$$\text{if } \delta(a,q)=(q',d',w) \text{ then }  \mu(a)(q,d)=(q',d') $$
\end{definition} 

