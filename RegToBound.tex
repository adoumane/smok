\begin{lemma}\label{lem:2idem}
Let $(M,\cdot)$ be a monoid and $\mu:\Sigma^*\to M$ be a morphism. Let $w_1,w_2, w_3\in\Sigma^*$ such that there exits $x,y,z,t,e,f\in M$ satisfying:
\begin{itemize}
\item $\mu(w_1w_2)=x\cdot e$ and $\mu(w_3)=e\cdot y$,
\item $\mu(w_1)=z\cdot f$ and $\mu(w_2w_3)=f\cdot t$,
\item $e$ and $f$ are idempotent.
\end{itemize}
For every $u, v\in\Sigma^*$ such that $\mu(u)=e$ and $\mu(v)=f$ we have that:
\begin{itemize}
\item $\mu(w_1vw_2)=x\cdot e$, 
\item $\mu(w_2uw_3)=f\cdot t$.
\end{itemize}
\end{lemma}

\begin{pr}
We have that $\mu(w_1v)=z\cdot f\cdot f=z\cdot f=\mu(w_1)$.
Thus $\mu(w_1vw_2)=\mu(w_1v)\cdot \mu(w_2)=\mu(w_1)\cdot \mu(w_2)=\mu(w_1\cdot w_2) =x\cdot e$.
We proceed in the same way for the other equality.
\end{pr}

\begin{definition}[Producing loop]
Let $T=(\Sigma,\Gamma,Q,q_I,q_F, \delta)$ be a 1-pebble transducer, and let $\Delta\subseteq \Gamma$. Let $x, e, y\in M_\Delta$, with $xey\in \mu_\Delta( { \vdash}\Sigma^*{ \dashv})$.

We say that the triplet $(x,e,y)$ is \emph{$\Delta$-linear} if the transition sequence of $(xe,ey)$
$(q_i,d_i)_{i\in[0,n]}$ satisfies the following conditions:
\begin{itemize}
\item $q_0=q_I$ and $q_n=q_F$;
\item $e$ is idempotent i.e. $e.e=e$;
\item there exists $i\in [1,n-1]$ such that $e(q_i,d_i)$ is of the form $(q,d,1)$.
\end{itemize}
\end{definition}

 \begin{definition}
Let $f:\Sigma^*\to \Gamma^*$ be a function and $\Delta\subseteq\Gamma$. We say that $f$ is bounded (resp. linear, \textit{etc}) in $\Delta$ if $\pi_\Delta\circ f: \Sigma^*\to \Delta^*$ is bounded (resp. linear, \textit{etc}), where $\pi_\Delta:\Gamma^*\to \Delta^*$ is the morphism defined on letters as follows:
\begin{align*}
\pi_\Delta(a)&=a \text{ if }  a\in \Delta \\
&= \epsilon \text{ otherwise.}
\end{align*}
 \end{definition}
 
\begin{theorem}\label{thm:linear}
A 1-pebble transducer is strictly linear in $\Delta$ if and only if it has a $\Delta$-linear triple.
\end{theorem}

\begin{proof}
    We know that a one-pebble transducer realizes a linear function, from Proposition~\ref{prop:degree}.
    Let $T$ be a one-pebble transducer realizing a function $f:\Sigma^*\rightarrow \Gamma^*$, and let $\Delta\subseteq \Gamma$.

    Let us first assume that there exists a $\Delta$-linear triple $(m_0,e_1,m_1)$, and let $w$ be a word such that $\vdash w\dashv $ has a $1$ factorization $(w_0,x_1,y_1,z_1,w_1)$ according to this triple.
    Then we show that since $(m_0,e_1,m_1)$ is $\Delta$-linear, $|f(w_0x_1y_2^nz_1w_1)|=\Theta(n)$.
    By definition of $\Delta$-linear triple, the output while reading a $y_1$ factor is non-empty, hence $f$ is strictly linear.

    Let us now assume that there are no $\Delta$-linear triples.
    According to the Factorization Forest Theorem of Simon, there exists an integer $d$ such that any word of length greater than $d$ has a $1$-factorization.
    Let $w$ be a word with a $1$-factorization $(w_0,x_1,y_1,z_1,w_1)$. Since there are no $\Delta$-linear triple, $(\mu_\Delta(w_0),\mu_\Delta(y_1),\mu_\Delta(w_1))$ is not $\Delta$-linear. This means that the outputs corresponding to the factor $y_1$ in the run over $w$ are all empty, and thus we have $|f(w_0x_1y_1z_1w_1)|=|f(w_0x_1z_1w_1)|$.
    Hence we have $\set{|f(w)|\mid\ w\in \Sigma^*}=\set{|f(w)|\mid\ w\in \Sigma^{\leq d}}$, hence $f$ is bounded.
\end{proof}